<%inherit file="../layout.html"/>
<%namespace file="larryslist:lib/formlib/templates/baseform.html" name="baseform"/>


<%def name="content()">
    <div class="container centered cart-page">
        <div class="row">
            <form class="${view.form.classes}" id="${view.form.id}" method="POST">
                <div class="span8">
                    ${baseform.prelims(view.form)}
                    <div class="search-results-container">
                        <h5 class="box-title inline tinted">Shopping Cart</h5>

                        <div class="search-results-header">
                            <div class="search-column picture">
                                Collector
                            </div><div class="search-column completion">
                                Completion
                            </div><div class="search-column subscribers">
                                Followers
                            </div><div class="search-column rank">
                                Rank
                            </div>
                            <div class="search-column details">
                                &nbsp;
                            </div>
                        </div>
                        <ul class="search-results-body cart-items">
                            %for i, collector in enumerate(vctxt.cart.getCollectors()):
                                ${self.buildItem(view.form, i, collector)}
                            %endfor
                        </ul>
                    </div>

                    <div class="cart-buttons">
                        %if not vctxt.cart.canSpend(vctxt.user):
                            <span class="insufficient-credits pull-right">
                                %if not len(vctxt.cart.getItems()):
                                    No profiles selected yet:
                                    <a href="${request.fwd_url("website_search")}" class="btn btn-primary">Search for profiles</a>
                                %elif not vctxt.user.getCredits():
                                    No credits yet:
                                    <a href="${request.fwd_url("website_checkout")}" class="btn btn-primary">Buy more credits</a>
                                %else:
                                    Not enough credits:
                                    <a href="${request.fwd_url("website_checkout")}" class="btn btn-primary">Buy more credits</a>
                                %endif
                            </span>
                        %else:
                                <a href="${request.fwd_url("website_checkout")}" class="btn btn-primary">Buy more credits</a>&nbsp;&nbsp;&nbsp;&nbsp;
                        %endif
                        <a href="${request.fwd_url("website_search")}" class="btn">Back to Search</a>
                    </div>
                </div>
                <div class="span4">
                    <div class="standard-box">
                        <h5 class="box-title inline">Proceed</h5>
                        <div class="cart-dropdown-section sidebarbox" data-template="templates/checkout-cart.html">
                            <div class="cart-attach-dropdown">
                                <img src="${ROOT_STATIC_URL}/img/ajax-loader.gif"/>
                            </div>
                            <br/>
                            <div class="flyout-line">
                                <button type="submit" class="js-spend-credit btn btn-primary btn-large wide-button" ${'' if vctxt.cart.canSpend(vctxt.user) else 'disabled'}>Buy now</button>
                            </div>
                        </div>
                        <hr/>
                        <div class="sidebarbox">
                            <b>This is what you get:</b>
                            <ul>
                                <li>access to profile for 1 year (free updated included)</li>
                                <li>all available information on profile (incl. address, collection, etc.)</li>
                                <li>access from everywhere 24/7</li>
                            </ul>
                        </div>

                    </div>
                </div>
            </form>
        </div>
    </div>
</%def>


<%def name="buildItem(form, pos, item)">
    <li class="search-results-row sortable">
        <span class="marked-checkbox checked"></span>
        <input type="hidden" name="${form.id}.Collector-${pos}.id" value="${item.id}"/>
        <div class="search-column completion">
            <b>${item.completion}%</b>
        </div><div class="search-column subscribers">
        <b>${item.subscribers}</b>
    </div><div class="search-column rank">
        <b>${item.rank}</b>
    </div><div class="search-column details">
        <div class="name">${item.getName()}</div>
        <p class="location">${item.getAddress()}</p>
        <a class="btn btn-primary dismiss" data-entity-id="${item.id}">Remove</a>
    </div>
    </li>
</%def>

<%block name="options">
    options.pageconfig.CART_PAGE = {el: $("#${view.form.id}")};
</%block>
<%block name="scripts">
    <script>
        require(["tools/ajax"], function(ajax){
            ajax.ifyForm({form: $("#${view.form.id}")});
        });
    </script>
</%block>